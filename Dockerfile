ARG NODE_VERSION=18-alpine
FROM node:${NODE_VERSION} as runner
WORKDIR /app

COPY ./package.json package-lock.json ./
COPY ./apps/msal-react-demo/next.config.js ./
COPY ./apps/msal-react-demo/.next ./.next
COPY ./apps/msal-react-demo/public ./public

RUN npm ci

ARG NEXT_PUBLIC_AZURE_B2C_AUTHORITY
ARG NEXT_PUBLIC_AZURE_B2C_CLIENT_ID
ARG NEXT_PUBLIC_AZURE_B2C_FLOW_EDIT_PROFILE
ARG NEXT_PUBLIC_AZURE_B2C_FLOW_FORGOT_PASSWORD
ARG NEXT_PUBLIC_AZURE_B2C_FLOW_SIGN_UP_SIGN_IN
ARG NEXT_PUBLIC_AZURE_B2C_REDIRECT_URI
ARG NEXT_PUBLIC_AZURE_B2C_TENANT_ID
ARG AZURE_COSMOSDB_ENDPOINT
ARG AZURE_COSMOSDB_KEY
ARG AZURE_COSMOSDB_DATABASE_ID
ARG AZURE_COSMOSDB_CONTAINER_ID

ENV NEXT_PUBLIC_AZURE_B2C_AUTHORITY=$NEXT_PUBLIC_AZURE_B2C_AUTHORITY
ENV NEXT_PUBLIC_AZURE_B2C_CLIENT_ID=$NEXT_PUBLIC_AZURE_B2C_CLIENT_ID
ENV NEXT_PUBLIC_AZURE_B2C_FLOW_EDIT_PROFILE=$NEXT_PUBLIC_AZURE_B2C_FLOW_EDIT_PROFILE
ENV NEXT_PUBLIC_AZURE_B2C_FLOW_FORGOT_PASSWORD=$NEXT_PUBLIC_AZURE_B2C_FLOW_FORGOT_PASSWORD
ENV NEXT_PUBLIC_AZURE_B2C_FLOW_SIGN_UP_SIGN_IN=$NEXT_PUBLIC_AZURE_B2C_FLOW_SIGN_UP_SIGN_IN
ENV NEXT_PUBLIC_AZURE_B2C_REDIRECT_URI=$NEXT_PUBLIC_AZURE_B2C_REDIRECT_URI
ENV NEXT_PUBLIC_AZURE_B2C_TENANT_ID=$NEXT_PUBLIC_AZURE_B2C_TENANT_ID
ENV AZURE_COSMOSDB_ENDPOINT=$AZURE_COSMOSDB_ENDPOINT
ENV AZURE_COSMOSDB_KEY=$AZURE_COSMOSDB_KEY
ENV AZURE_COSMOSDB_DATABASE_ID=$AZURE_COSMOSDB_DATABASE_ID
ENV AZURE_COSMOSDB_CONTAINER_ID=$AZURE_COSMOSDB_CONTAINER_ID

CMD ["npx", "next", "start"]